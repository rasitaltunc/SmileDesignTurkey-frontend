{"version":3,"file":"product-tours.js","sourceRoot":"","sources":["../../../../src/extensions/product-tours/product-tours.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,iCAA+B;AAQ/B,qEAAuG;AACvG,6DAA2G;AAC3G,sEAAoE;AACpE,6CAAiD;AACjD,+CAA8E;AAC9E,yCAA0C;AAC1C,qCAA8C;AAC9C,sCAAuD;AACvD,6DAAgE;AAEhE,IAAM,MAAM,GAAG,IAAA,qBAAY,EAAC,iBAAiB,CAAC,CAAA;AAE9C,IAAM,QAAQ,GAAG,kBAAqB,CAAA;AACtC,IAAM,MAAM,GAAG,gBAAqC,CAAA;AAEpD,0EAA0E;AAC1E,SAAS,gBAAgB,CAAC,IAAiB;;IACvC,IAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAA;IAClC,IAAI,CAAC,CAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,GAAG,CAAA,EAAE,CAAC;QACnB,OAAO,IAAI,CAAA;IACf,CAAC;IAED,IAAM,IAAI,GAAG,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,QAAQ,0CAAE,IAAI,CAAA;IACnC,IAAI,CAAC,IAAI,EAAE,CAAC;QACR,OAAO,KAAK,CAAA;IAChB,CAAC;IAED,IAAM,OAAO,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAA;IAChC,IAAM,SAAS,GAAG,UAAU,CAAC,YAAY,IAAI,sBAAe,CAAC,SAAS,CAAA;IACtE,OAAO,oCAAmB,CAAC,SAAS,CAAC,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC,CAAA;AAC1D,CAAC;AAED,SAAS,qBAAqB,CAAC,IAAiB;IAC5C,IAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAA;IAClC,IAAI,CAAC,CAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,QAAQ,CAAA,EAAE,CAAC;QACxB,OAAO,IAAI,CAAA;IACf,CAAC;IAED,IAAI,CAAC;QACD,OAAO,CAAC,IAAA,aAAM,EAAC,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAA;IAC/D,CAAC;IAAC,WAAM,CAAC;QACL,OAAO,KAAK,CAAA;IAChB,CAAC;AACL,CAAC;AAED,SAAS,iBAAiB,CAAC,IAAiB;IACxC,IAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAA;IAEtB,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAM,SAAS,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC3C,IAAI,GAAG,GAAG,SAAS,EAAE,CAAC;YAClB,OAAO,KAAK,CAAA;QAChB,CAAC;IACL,CAAC;IAED,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAM,OAAO,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QACvC,IAAI,GAAG,GAAG,OAAO,EAAE,CAAC;YAChB,OAAO,KAAK,CAAA;QAChB,CAAC;IACL,CAAC;IAED,OAAO,IAAI,CAAA;AACf,CAAC;AAED,SAAS,mBAAmB,CAAC,IAAiB;IAC1C,OAAO,iBAAiB,CAAC,IAAI,CAAC,IAAI,gBAAgB,CAAC,IAAI,CAAC,IAAI,qBAAqB,CAAC,IAAI,CAAC,CAAA;AAC3F,CAAC;AAED,IAAM,eAAe,GAAG,2BAA2B,CAAA;AACnD,IAAM,0BAA0B,GAAG,sBAAsB,CAAA;AACzD,IAAM,iBAAiB,GAAG,IAAI,CAAA;AAQ9B,SAAS,kBAAkB,CAAC,MAAc;IACtC,IAAM,cAAc,GAAG,UAAG,eAAe,cAAI,MAAM,CAAE,CAAA;IACrD,IAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,WAAI,cAAc,CAAE,CAAC,CAAA;IAEhE,IAAI,WAAW,IAAI,WAAW,CAAC,UAAU,EAAE,CAAC;QACxC,OAAO;YACH,MAAM,EAAE,WAAW,CAAC,UAAU;YAC9B,cAAc,EAAE,KAAK;SACxB,CAAA;IACL,CAAC;IAED,IAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;IACzC,GAAG,CAAC,SAAS,GAAG,cAAc,CAAA;IAC9B,IAAM,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAA;IAEjD,IAAM,UAAU,GAAG,IAAA,8CAAwB,GAAE,CAAA;IAC7C,IAAI,UAAU,EAAE,CAAC;QACb,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,CAAA;IAClC,CAAC;IAED,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAA;IAE9B,OAAO;QACH,MAAM,QAAA;QACN,cAAc,EAAE,IAAI;KACvB,CAAA;AACL,CAAC;AAED,SAAS,iBAAiB,CAAC,MAAc;IACrC,IAAM,cAAc,GAAG,UAAG,eAAe,cAAI,MAAM,CAAE,CAAA;IACrD,IAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,WAAI,cAAc,CAAE,CAAC,CAAA;IAC9D,IAAI,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,UAAU,EAAE,CAAC;QACxB,IAAA,eAAM,EAAC,IAAI,EAAE,SAAS,CAAC,UAAU,CAAC,CAAA;IACtC,CAAC;IACD,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,MAAM,EAAE,CAAA;AACvB,CAAC;AAED;IASI,4BAAY,QAAiB;QAA7B,iBAEC;QATO,gBAAW,GAAuB,IAAI,CAAA;QACtC,sBAAiB,GAAW,CAAC,CAAA;QAC7B,kBAAa,GAA4B,MAAM,CAAA;QAC/C,mBAAc,GAA0C,IAAI,CAAA;QAC5D,8BAAyB,GAAqC,IAAI,GAAG,EAAE,CAAA;QACvE,4BAAuB,GAAwB,IAAI,CAAA;QA6BnD,4BAAuB,GAAG;YAC9B,IAAI,QAAQ,CAAC,MAAM,IAAI,KAAI,CAAC,cAAc,EAAE,CAAC;gBACzC,aAAa,CAAC,KAAI,CAAC,cAAc,CAAC,CAAA;gBAClC,KAAI,CAAC,cAAc,GAAG,IAAI,CAAA;YAC9B,CAAC;iBAAM,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,CAAC,KAAI,CAAC,cAAc,EAAE,CAAC;gBAClD,KAAI,CAAC,cAAc,GAAG,WAAW,CAAC;oBAC9B,KAAI,CAAC,wBAAwB,EAAE,CAAA;gBACnC,CAAC,EAAE,iBAAiB,CAAC,CAAA;gBACrB,KAAI,CAAC,wBAAwB,EAAE,CAAA;YACnC,CAAC;QACL,CAAC,CAAA;QAgJD,aAAQ,GAAG;YACP,IAAI,CAAC,KAAI,CAAC,WAAW,EAAE,CAAC;gBACpB,OAAM;YACV,CAAC;YAED,IAAM,WAAW,GAAG,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAI,CAAC,iBAAiB,CAAC,CAAA;YAElE,KAAI,CAAC,aAAa,CAAC,6BAA6B,EAAE;gBAC9C,gBAAgB,EAAE,KAAI,CAAC,WAAW,CAAC,EAAE;gBACrC,qBAAqB,EAAE,WAAW,CAAC,EAAE;gBACrC,wBAAwB,EAAE,KAAI,CAAC,iBAAiB;aACnD,CAAC,CAAA;YAEF,IAAI,KAAI,CAAC,iBAAiB,GAAG,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC7D,KAAI,CAAC,iBAAiB,EAAE,CAAA;gBACxB,KAAI,CAAC,kBAAkB,EAAE,CAAA;YAC7B,CAAC;iBAAM,CAAC;gBACJ,KAAI,CAAC,aAAa,EAAE,CAAA;YACxB,CAAC;QACL,CAAC,CAAA;QAED,iBAAY,GAAG;YACX,IAAI,CAAC,KAAI,CAAC,WAAW,IAAI,KAAI,CAAC,iBAAiB,KAAK,CAAC,EAAE,CAAC;gBACpD,OAAM;YACV,CAAC;YAED,KAAI,CAAC,iBAAiB,EAAE,CAAA;YACxB,KAAI,CAAC,kBAAkB,EAAE,CAAA;QAC7B,CAAC,CAAA;QAED,gBAAW,GAAG,UAAC,MAAsD;YAAtD,uBAAA,EAAA,4BAAsD;YACjE,IAAI,CAAC,KAAI,CAAC,WAAW,EAAE,CAAC;gBACpB,OAAM;YACV,CAAC;YAED,IAAM,WAAW,GAAG,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAI,CAAC,iBAAiB,CAAC,CAAA;YAElE,KAAI,CAAC,aAAa,CAAC,wBAAwB,EAAE;gBACzC,gBAAgB,EAAE,KAAI,CAAC,WAAW,CAAC,EAAE;gBACrC,qBAAqB,EAAE,WAAW,CAAC,EAAE;gBACrC,wBAAwB,EAAE,KAAI,CAAC,iBAAiB;gBAChD,4BAA4B,EAAE,MAAM;aACvC,CAAC,CAAA;YAEF,oBAAU,CAAC,IAAI,CAAC,oCAA6B,KAAI,CAAC,WAAW,CAAC,EAAE,CAAE,EAAE,IAAI,CAAC,CAAA;YAEzE,KAAI,CAAC,QAAQ,EAAE,CAAA;QACnB,CAAC,CAAA;QAnOG,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAA;IAC7B,CAAC;IAED,kCAAK,GAAL;QAAA,iBAWC;QAVG,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,OAAM;QACV,CAAC;QAED,IAAI,CAAC,cAAc,GAAG,WAAW,CAAC;YAC9B,KAAI,CAAC,wBAAwB,EAAE,CAAA;QACnC,CAAC,EAAE,iBAAiB,CAAC,CAAA;QAErB,IAAI,CAAC,wBAAwB,EAAE,CAAA;QAC/B,IAAA,wBAAgB,EAAC,QAAQ,EAAE,kBAAkB,EAAE,IAAI,CAAC,uBAAuB,CAAC,CAAA;IAChF,CAAC;IAED,iCAAI,GAAJ;QACI,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,aAAa,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;YAClC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;QAC9B,CAAC;QACD,QAAQ,CAAC,mBAAmB,CAAC,kBAAkB,EAAE,IAAI,CAAC,uBAAuB,CAAC,CAAA;QAC9E,IAAI,CAAC,0BAA0B,EAAE,CAAA;QACjC,IAAI,CAAC,QAAQ,EAAE,CAAA;IACnB,CAAC;IAcO,qDAAwB,GAAhC;QAAA,iBAmCC;;QAlCG,iFAAiF;QACjF,0CAA0C;QAC1C,MAAA,IAAI,CAAC,SAAS,CAAC,YAAY,0CAAE,eAAe,CAAC,UAAC,KAAK;;;YAC/C,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBACrB,KAAI,CAAC,0BAA0B,EAAE,CAAA;gBACjC,OAAM;YACV,CAAC;YAED,IAAM,oBAAoB,GAAG,IAAI,GAAG,EAAU,CAAA;;gBAE9C,KAAmB,IAAA,UAAA,SAAA,KAAK,CAAA,4BAAA,+CAAE,CAAC;oBAAtB,IAAM,IAAI,kBAAA;oBACX,+EAA+E;oBAC/E,6EAA6E;oBAC7E,IAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,MAAA,IAAI,CAAC,UAAU,0CAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;oBAEvG,wDAAwD;oBACxD,qDAAqD;oBACrD,IAAI,eAAe,EAAE,CAAC;wBAClB,oBAAoB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;wBACjC,KAAI,CAAC,8BAA8B,uBAAM,IAAI,KAAE,gBAAgB,EAAE,eAAe,IAAG,CAAA;oBACvF,CAAC;oBAED,2CAA2C;oBAC3C,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,KAAI,CAAC,WAAW,IAAI,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC;wBACtE,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;oBACvB,CAAC;gBACL,CAAC;;;;;;;;;YAED,KAAI,CAAC,yBAAyB,CAAC,OAAO,CAAC,UAAC,EAAQ;oBAAN,IAAI,UAAA;gBAC1C,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC;oBACrC,KAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;gBAChD,CAAC;YACL,CAAC,CAAC,CAAA;QACN,CAAC,CAAC,CAAA;IACN,CAAC;IAEO,4CAAe,GAAvB,UAAwB,IAAiB;;QACrC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE,CAAC;YAC7B,MAAM,CAAC,IAAI,CAAC,eAAQ,IAAI,CAAC,EAAE,6BAA0B,CAAC,CAAA;YACtD,OAAO,KAAK,CAAA;QAChB,CAAC;QAED,IAAM,YAAY,GAAG,oCAA6B,IAAI,CAAC,EAAE,CAAE,CAAA;QAC3D,IAAM,YAAY,GAAG,oCAA6B,IAAI,CAAC,EAAE,CAAE,CAAA;QAE3D,IAAI,oBAAU,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,oBAAU,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC;YACjE,MAAM,CAAC,IAAI,CAAC,eAAQ,IAAI,CAAC,EAAE,oCAAiC,CAAC,CAAA;YAC7D,OAAO,KAAK,CAAA;QAChB,CAAC;QAED,IAAI,IAAI,CAAC,2BAA2B,EAAE,CAAC;YACnC,IAAM,SAAS,GAAG,MAAA,IAAI,CAAC,SAAS,CAAC,YAAY,0CAAE,cAAc,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAA;YAC/F,IAAI,CAAC,SAAS,EAAE,CAAC;gBACb,MAAM,CAAC,IAAI,CAAC,eAAQ,IAAI,CAAC,EAAE,yCAA+B,IAAI,CAAC,2BAA2B,CAAE,CAAC,CAAA;gBAC7F,OAAO,KAAK,CAAA;YAChB,CAAC;QACL,CAAC;QAED,OAAO,IAAI,CAAA;IACf,CAAC;IAED,qCAAQ,GAAR,UAAS,IAAiB,EAAE,MAAwC;;QAAxC,uBAAA,EAAA,eAAwC;QAChE,sDAAsD;QACtD,oEAAoE;QACpE,IAAM,gBAAgB,GAMjB,EAAE,CAAA;QAEP,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACzC,IAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;YAE1B,gDAAgD;YAChD,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACjB,SAAQ;YACZ,CAAC;YAED,IAAM,MAAM,GAAG,IAAA,2CAAqB,EAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YAEnD,IAAI,MAAM,CAAC,KAAK,KAAK,WAAW,IAAI,MAAM,CAAC,KAAK,KAAK,aAAa,EAAE,CAAC;gBACjE,gBAAgB,CAAC,IAAI,CAAC;oBAClB,SAAS,EAAE,CAAC;oBACZ,MAAM,EAAE,IAAI,CAAC,EAAE;oBACf,QAAQ,EAAE,IAAI,CAAC,QAAQ;oBACvB,KAAK,EAAE,MAAM,CAAC,KAAK;oBACnB,UAAU,EAAE,MAAM,CAAC,UAAU;iBAChC,CAAC,CAAA;YACN,CAAC;QACL,CAAC;QAED,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;;gBAC9B,mEAAmE;gBACnE,KAAsB,IAAA,qBAAA,SAAA,gBAAgB,CAAA,kDAAA,gFAAE,CAAC;oBAApC,IAAM,OAAO,6BAAA;oBACd,IAAI,CAAC,aAAa,CAAC,mCAAmC,EAAE;wBACpD,gBAAgB,EAAE,IAAI,CAAC,EAAE;wBACzB,qBAAqB,EAAE,OAAO,CAAC,MAAM;wBACrC,wBAAwB,EAAE,OAAO,CAAC,SAAS;wBAC3C,2BAA2B,EAAE,OAAO,CAAC,QAAQ;wBAC7C,mBAAmB,EAAE,OAAO,CAAC,KAAK;wBAClC,2BAA2B,EAAE,OAAO,CAAC,UAAU;wBAC/C,2BAA2B,EAAE,YAAY;qBAC5C,CAAC,CAAA;gBACN,CAAC;;;;;;;;;YAED,IAAM,eAAe,GAAG,gBAAgB,CAAC,GAAG,CAAC,UAAC,CAAC,IAAK,OAAA,eAAQ,CAAC,CAAC,SAAS,iBAAM,CAAC,CAAC,QAAQ,iBAAM,CAAC,CAAC,KAAK,MAAG,EAAnD,CAAmD,CAAC,CAAA;YACxG,MAAM,CAAC,IAAI,CACP,iBAAS,IAAI,CAAC,IAAI,iBAAM,IAAI,CAAC,EAAE,0BAAgB,gBAAgB,CAAC,MAAM,gDAAsC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAE,CAC/I,CAAA;YACD,OAAM;QACV,CAAC;QAED,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;QACvB,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAA;QAC1B,IAAI,CAAC,aAAa,GAAG,MAAM,CAAA;QAE3B,IAAI,CAAC,aAAa,CAAC,oBAAoB,EAAE;YACrC,gBAAgB,EAAE,IAAI,CAAC,EAAE;YACzB,kBAAkB,EAAE,IAAI,CAAC,IAAI;YAC7B,uBAAuB,EAAE,IAAI,CAAC,iBAAiB,IAAI,CAAC;YACpD,2BAA2B,EAAE,MAAM;SACtC,CAAC,CAAA;QAEF,IAAI,CAAC,kBAAkB,EAAE,CAAA;IAC7B,CAAC;IAED,yCAAY,GAAZ,UAAa,MAAc;QAA3B,iBAWC;;QAVG,MAAM,CAAC,IAAI,CAAC,uBAAgB,MAAM,MAAG,CAAC,CAAA;QACtC,MAAA,IAAI,CAAC,SAAS,CAAC,YAAY,0CAAE,eAAe,CAAC,UAAC,KAAK;YAC/C,IAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,EAAE,KAAK,MAAM,EAAf,CAAe,CAAC,CAAA;YAC/C,IAAI,IAAI,EAAE,CAAC;gBACP,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAA;gBACjC,KAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;YAC9B,CAAC;iBAAM,CAAC;gBACJ,MAAM,CAAC,IAAI,CAAC,qBAAqB,EAAE,MAAM,CAAC,CAAA;YAC9C,CAAC;QACL,CAAC,CAAC,CAAA;IACN,CAAC;IAmDO,0CAAa,GAArB;;QACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACpB,OAAM;QACV,CAAC;QAED,IAAI,CAAC,aAAa,CAAC,wBAAwB,EAAE;YACzC,gBAAgB,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;YACrC,yBAAyB,EAAE,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM;SAC3D,CAAC,CAAA;QAEF,oBAAU,CAAC,IAAI,CAAC,oCAA6B,IAAI,CAAC,WAAW,CAAC,EAAE,CAAE,EAAE,IAAI,CAAC,CAAA;QAEzE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE;YAC3B,IAAI;gBACA,GAAC,kCAA2B,IAAI,CAAC,WAAW,CAAC,EAAE,CAAE,IAAG,IAAI;mBAC3D;SACJ,CAAC,CAAA;QAEF,IAAI,CAAC,QAAQ,EAAE,CAAA;IACnB,CAAC;IAEO,+CAAkB,GAA1B;QACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACpB,OAAM;QACV,CAAC;QAED,IAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAA;QAE3D,oEAAoE;QACpE,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;YAC3C,OAAM;QACV,CAAC;QAED,6DAA6D;QAC7D,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YACjB,IAAI,CAAC,aAAa,CAAC,yBAAyB,EAAE;gBAC1C,gBAAgB,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;gBACrC,qBAAqB,EAAE,IAAI,CAAC,EAAE;gBAC9B,wBAAwB,EAAE,IAAI,CAAC,iBAAiB;gBAChD,uBAAuB,EAAE,OAAO;aACnC,CAAC,CAAA;YAEF,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAA;YACnC,OAAM;QACV,CAAC;QAED,IAAM,MAAM,GAAG,IAAA,2CAAqB,EAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAEnD,IAAI,MAAM,CAAC,KAAK,KAAK,WAAW,IAAI,MAAM,CAAC,KAAK,KAAK,aAAa,EAAE,CAAC;YACjE,IAAI,CAAC,aAAa,CAAC,mCAAmC,EAAE;gBACpD,gBAAgB,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;gBACrC,qBAAqB,EAAE,IAAI,CAAC,EAAE;gBAC9B,wBAAwB,EAAE,IAAI,CAAC,iBAAiB;gBAChD,2BAA2B,EAAE,IAAI,CAAC,QAAQ;gBAC1C,mBAAmB,EAAE,MAAM,CAAC,KAAK;gBACjC,2BAA2B,EAAE,MAAM,CAAC,UAAU;gBAC9C,2BAA2B,EAAE,SAAS;aACzC,CAAC,CAAA;YAEF,MAAM,CAAC,IAAI,CACP,iBAAS,IAAI,CAAC,WAAW,CAAC,IAAI,4CAAiC,IAAI,CAAC,iBAAiB,kCAAwB,MAAM,CAAC,KAAK,MAAG,CAC/H,CAAA;YACD,IAAI,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAA;YACvC,OAAM;QACV,CAAC;QAED,IAAI,MAAM,CAAC,KAAK,KAAK,kBAAkB,EAAE,CAAC;YACtC,IAAI,CAAC,aAAa,CAAC,mCAAmC,EAAE;gBACpD,gBAAgB,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;gBACrC,qBAAqB,EAAE,IAAI,CAAC,EAAE;gBAC9B,wBAAwB,EAAE,IAAI,CAAC,iBAAiB;gBAChD,2BAA2B,EAAE,IAAI,CAAC,QAAQ;gBAC1C,mBAAmB,EAAE,MAAM,CAAC,KAAK;gBACjC,2BAA2B,EAAE,MAAM,CAAC,UAAU;gBAC9C,2BAA2B,EAAE,SAAS;aACzC,CAAC,CAAA;YACF,sDAAsD;QAC1D,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;YAClB,OAAM;QACV,CAAC;QAED,IAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAA;QAC9B,IAAM,QAAQ,GAAG,IAAA,wCAAkB,EAAC,OAAO,CAAC,CAAA;QAE5C,IAAI,CAAC,aAAa,CAAC,yBAAyB,EAAE;YAC1C,gBAAgB,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;YACrC,qBAAqB,EAAE,IAAI,CAAC,EAAE;YAC9B,wBAAwB,EAAE,IAAI,CAAC,iBAAiB;YAChD,2BAA2B,EAAE,IAAI,CAAC,QAAQ;YAC1C,iCAAiC,EAAE,IAAI;YACvC,8BAA8B,EAAE,QAAQ,CAAC,GAAG;YAC5C,6BAA6B,EAAE,QAAQ,CAAC,EAAE;YAC1C,kCAAkC,EAAE,QAAQ,CAAC,OAAO;YACpD,+BAA+B,EAAE,QAAQ,CAAC,IAAI;SACjD,CAAC,CAAA;QAEF,IAAI,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAA;IAC1C,CAAC;IAEO,qDAAwB,GAAhC,UAAiC,OAA2B;QACxD,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACpB,OAAM;QACV,CAAC;QAED,IAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAA;QACnD,IAAA,MAAM,GAAK,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,OAA5C,CAA4C;QAE1D,IAAA,eAAM,EACF,uBAAC,uCAAkB,IACf,IAAI,EAAE,IAAI,CAAC,WAAW,EACtB,IAAI,EAAE,IAAI,EACV,SAAS,EAAE,IAAI,CAAC,iBAAiB,EACjC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,EACzC,aAAa,EAAE,OAAO,EACtB,MAAM,EAAE,IAAI,CAAC,QAAQ,EACrB,UAAU,EAAE,IAAI,CAAC,YAAY,EAC7B,SAAS,EAAE,IAAI,CAAC,WAAW,GAC7B,EACF,MAAM,CACT,CAAA;IACL,CAAC;IAEO,8CAAiB,GAAzB,UAA0B,QAAgB;QAA1C,iBAgDC;;QA/CG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACpB,OAAM;QACV,CAAC;QAED,IAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAA;QAE3D,6BAA6B;QAC7B,IAAI,CAAC,aAAa,CAAC,yBAAyB,EAAE;YAC1C,gBAAgB,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;YACrC,qBAAqB,EAAE,IAAI,CAAC,EAAE;YAC9B,wBAAwB,EAAE,IAAI,CAAC,iBAAiB;YAChD,uBAAuB,EAAE,QAAQ;YACjC,8BAA8B,EAAE,QAAQ;SAC3C,CAAC,CAAA;QAEF,8CAA8C;QAC9C,IAAI,CAAC,sBAAsB,EAAE,CAAA;QAE7B,oCAAoC;QACpC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAC5C,eAAe,EACf,UAAC,IAAyD;;YACtD,IAAM,aAAa,GAAG,MAAA,IAAI,CAAC,UAAU,0CAAG,6CAAqB,CAAC,SAAS,CAAC,CAAA;YACxE,IAAI,aAAa,KAAK,QAAQ,EAAE,CAAC;gBAC7B,OAAM;YACV,CAAC;YAED,IAAI,IAAI,CAAC,KAAK,KAAK,uCAAe,CAAC,IAAI,EAAE,CAAC;gBACtC,MAAM,CAAC,IAAI,CAAC,iBAAU,QAAQ,+BAA4B,CAAC,CAAA;gBAC3D,KAAI,CAAC,sBAAsB,EAAE,CAAA;gBAC7B,KAAI,CAAC,QAAQ,EAAE,CAAA;YACnB,CAAC;iBAAM,IAAI,IAAI,CAAC,KAAK,KAAK,uCAAe,CAAC,SAAS,EAAE,CAAC;gBAClD,MAAM,CAAC,IAAI,CAAC,iBAAU,QAAQ,gCAA6B,CAAC,CAAA;gBAC5D,KAAI,CAAC,sBAAsB,EAAE,CAAA;gBAC7B,KAAI,CAAC,WAAW,CAAC,mBAAmB,CAAC,CAAA;YACzC,CAAC;QACL,CAAC,CACJ,CAAA;QAED,qBAAqB;QACrB,MAAA,IAAI,CAAC,SAAS,CAAC,OAAO,0CAAE,aAAa,CAAC,QAAQ,EAAE;YAC5C,gBAAgB,EAAE,IAAI;YACtB,WAAW,EAAE,IAAI;YACjB,WAAW,EAAE,yCAAiB,CAAC,OAAO;SACzC,CAAC,CAAA;QAEF,MAAM,CAAC,IAAI,CAAC,2BAAoB,QAAQ,4BAAkB,IAAI,CAAC,iBAAiB,CAAE,CAAC,CAAA;IACvF,CAAC;IAEO,mDAAsB,GAA9B;;QACI,MAAA,IAAI,CAAC,uBAAuB,oDAAI,CAAA;QAChC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAA;IACvC,CAAC;IAEO,qCAAQ,GAAhB;QACI,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,iBAAiB,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAA;QAC1C,CAAC;QAED,IAAI,CAAC,sBAAsB,EAAE,CAAA;QAC7B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;QACvB,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAA;QAC1B,IAAI,CAAC,aAAa,GAAG,MAAM,CAAA;IAC/B,CAAC;IAEO,2DAA8B,GAAtC,UAAuC,IAAiB;QAAxD,iBA0CC;QAzCG,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACzB,OAAM;QACV,CAAC;QAED,IAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAA;QACpE,IAAM,oBAAoB,GAAG,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;QAExE,IAAI,CAAC,cAAc,EAAE,CAAC;YAClB,IAAI,oBAAoB,EAAE,CAAC;gBACvB,IAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;YAChD,CAAC;YACD,OAAM;QACV,CAAC;QAED,IAAI,oBAAoB,EAAE,CAAC;YACvB,IAAI,cAAc,KAAK,oBAAoB,CAAC,OAAO,EAAE,CAAC;gBAClD,MAAM,CAAC,IAAI,CAAC,2CAAoC,IAAI,CAAC,EAAE,6BAA0B,CAAC,CAAA;gBAClF,IAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;YAChD,CAAC;iBAAM,CAAC;gBACJ,OAAM;YACV,CAAC;QACL,CAAC;QAED,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,0BAA0B,CAAC,EAAE,CAAC;YAC3D,IAAM,QAAQ,GAAG,UAAC,KAAY;gBAC1B,KAAK,CAAC,eAAe,EAAE,CAAA;gBAEvB,IAAI,KAAI,CAAC,WAAW,EAAE,CAAC;oBACnB,MAAM,CAAC,IAAI,CAAC,eAAQ,IAAI,CAAC,EAAE,gDAA6C,CAAC,CAAA;oBACzE,OAAM;gBACV,CAAC;gBAED,MAAM,CAAC,IAAI,CAAC,eAAQ,IAAI,CAAC,EAAE,oCAA0B,IAAI,CAAC,gBAAgB,CAAE,CAAC,CAAA;gBAC7E,KAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,SAAS,CAAC,CAAA;YAClC,CAAC,CAAA;YAED,IAAA,wBAAgB,EAAC,cAAc,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAA;YACnD,cAAc,CAAC,YAAY,CAAC,0BAA0B,EAAE,IAAI,CAAC,EAAE,CAAC,CAAA;YAChE,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,OAAO,EAAE,cAAc,EAAE,QAAQ,UAAA,EAAE,IAAI,MAAA,EAAE,CAAC,CAAA;YACxF,MAAM,CAAC,IAAI,CAAC,6CAAsC,IAAI,CAAC,EAAE,iBAAO,IAAI,CAAC,gBAAgB,CAAE,CAAC,CAAA;QAC5F,CAAC;IACL,CAAC;IAEO,2DAA8B,GAAtC,UAAuC,MAAc;QACjD,IAAM,QAAQ,GAAG,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;QAC3D,IAAI,QAAQ,EAAE,CAAC;YACX,QAAQ,CAAC,OAAO,CAAC,mBAAmB,CAAC,OAAO,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAA;YAChE,QAAQ,CAAC,OAAO,CAAC,eAAe,CAAC,0BAA0B,CAAC,CAAA;YAC5D,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;YAC7C,MAAM,CAAC,IAAI,CAAC,4CAAqC,MAAM,CAAE,CAAC,CAAA;QAC9D,CAAC;IACL,CAAC;IAEO,uDAA0B,GAAlC;QAAA,iBAIC;QAHG,IAAI,CAAC,yBAAyB,CAAC,OAAO,CAAC,UAAC,CAAC,EAAE,MAAM;YAC7C,KAAI,CAAC,8BAA8B,CAAC,MAAM,CAAC,CAAA;QAC/C,CAAC,CAAC,CAAA;IACN,CAAC;IAEO,0CAAa,GAArB,UAAsB,SAAiB,EAAE,UAA+B;QACpE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,EAAE,UAAU,CAAC,CAAA;IACjD,CAAC;IAED,wDAAwD;IACxD,kDAAqB,GAArB,UAAsB,QAA6B;QAAnD,iBAUC;;QATG,MAAA,IAAI,CAAC,SAAS,CAAC,YAAY,0CAAE,eAAe,CAAC,UAAC,KAAK,EAAE,OAAO;YACxD,IAAI,CAAC,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,QAAQ,CAAA,EAAE,CAAC;gBACrB,QAAQ,CAAC,EAAE,EAAE,OAAO,CAAC,CAAA;gBACrB,OAAM;YACV,CAAC;YAED,IAAM,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,UAAC,IAAI,IAAK,OAAA,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAA1B,CAA0B,CAAC,CAAA;YACtE,QAAQ,CAAC,WAAW,EAAE,OAAO,CAAC,CAAA;QAClC,CAAC,CAAC,CAAA;IACN,CAAC;IAED,sCAAS,GAAT,UAAU,MAAc;QACpB,oBAAU,CAAC,OAAO,CAAC,oCAA6B,MAAM,CAAE,CAAC,CAAA;QACzD,oBAAU,CAAC,OAAO,CAAC,oCAA6B,MAAM,CAAE,CAAC,CAAA;IAC7D,CAAC;IAED,0CAAa,GAAb;QACI,IAAM,OAAO,GAAG,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,YAAY,CAAA;QACpC,IAAI,CAAC,OAAO,EAAE,CAAC;YACX,OAAM;QACV,CAAC;QACD,IAAM,YAAY,GAAa,EAAE,CAAA;QACjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACtC,IAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA;YAC1B,IAAI,CAAA,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,UAAU,CAAC,4BAA4B,CAAC,MAAI,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,UAAU,CAAC,4BAA4B,CAAC,CAAA,EAAE,CAAC;gBACjG,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;YAC1B,CAAC;QACL,CAAC;QACD,YAAY,CAAC,OAAO,CAAC,UAAC,GAAG,IAAK,OAAA,oBAAU,CAAC,OAAO,CAAC,GAAG,CAAC,EAAvB,CAAuB,CAAC,CAAA;IAC1D,CAAC;IACL,yBAAC;AAAD,CAAC,AA9gBD,IA8gBC;AA9gBY,gDAAkB","sourcesContent":["import { render } from 'preact'\nimport { PostHog } from '../../posthog-core'\nimport {\n    ProductTour,\n    ProductTourCallback,\n    ProductTourDismissReason,\n    ProductTourRenderReason,\n} from '../../posthog-product-tours-types'\nimport { DisplaySurveyType, SurveyEventName, SurveyEventProperties } from '../../posthog-surveys-types'\nimport { findElementBySelector, getElementMetadata, getProductTourStylesheet } from './product-tours-utils'\nimport { ProductTourTooltip } from './components/ProductTourTooltip'\nimport { createLogger } from '../../utils/logger'\nimport { document as _document, window as _window } from '../../utils/globals'\nimport { localStore } from '../../storage'\nimport { addEventListener } from '../../utils'\nimport { isNull, SurveyMatchType } from '@posthog/core'\nimport { propertyComparisons } from '../../utils/property-utils'\n\nconst logger = createLogger('[Product Tours]')\n\nconst document = _document as Document\nconst window = _window as Window & typeof globalThis\n\n// Tour condition checking - reuses the same URL matching logic as surveys\nfunction doesTourUrlMatch(tour: ProductTour): boolean {\n    const conditions = tour.conditions\n    if (!conditions?.url) {\n        return true\n    }\n\n    const href = window?.location?.href\n    if (!href) {\n        return false\n    }\n\n    const targets = [conditions.url]\n    const matchType = conditions.urlMatchType || SurveyMatchType.Icontains\n    return propertyComparisons[matchType](targets, [href])\n}\n\nfunction doesTourSelectorMatch(tour: ProductTour): boolean {\n    const conditions = tour.conditions\n    if (!conditions?.selector) {\n        return true\n    }\n\n    try {\n        return !isNull(document.querySelector(conditions.selector))\n    } catch {\n        return false\n    }\n}\n\nfunction isTourInDateRange(tour: ProductTour): boolean {\n    const now = new Date()\n\n    if (tour.start_date) {\n        const startDate = new Date(tour.start_date)\n        if (now < startDate) {\n            return false\n        }\n    }\n\n    if (tour.end_date) {\n        const endDate = new Date(tour.end_date)\n        if (now > endDate) {\n            return false\n        }\n    }\n\n    return true\n}\n\nfunction checkTourConditions(tour: ProductTour): boolean {\n    return isTourInDateRange(tour) && doesTourUrlMatch(tour) && doesTourSelectorMatch(tour)\n}\n\nconst CONTAINER_CLASS = 'ph-product-tour-container'\nconst TRIGGER_LISTENER_ATTRIBUTE = 'data-ph-tour-trigger'\nconst CHECK_INTERVAL_MS = 1000\n\ninterface TriggerListenerData {\n    element: Element\n    listener: (event: Event) => void\n    tour: ProductTour\n}\n\nfunction retrieveTourShadow(tourId: string): { shadow: ShadowRoot; isNewlyCreated: boolean } {\n    const containerClass = `${CONTAINER_CLASS}-${tourId}`\n    const existingDiv = document.querySelector(`.${containerClass}`)\n\n    if (existingDiv && existingDiv.shadowRoot) {\n        return {\n            shadow: existingDiv.shadowRoot,\n            isNewlyCreated: false,\n        }\n    }\n\n    const div = document.createElement('div')\n    div.className = containerClass\n    const shadow = div.attachShadow({ mode: 'open' })\n\n    const stylesheet = getProductTourStylesheet()\n    if (stylesheet) {\n        shadow.appendChild(stylesheet)\n    }\n\n    document.body.appendChild(div)\n\n    return {\n        shadow,\n        isNewlyCreated: true,\n    }\n}\n\nfunction removeTourFromDom(tourId: string): void {\n    const containerClass = `${CONTAINER_CLASS}-${tourId}`\n    const container = document.querySelector(`.${containerClass}`)\n    if (container?.shadowRoot) {\n        render(null, container.shadowRoot)\n    }\n    container?.remove()\n}\n\nexport class ProductTourManager {\n    private _instance: PostHog\n    private _activeTour: ProductTour | null = null\n    private _currentStepIndex: number = 0\n    private _renderReason: ProductTourRenderReason = 'auto'\n    private _checkInterval: ReturnType<typeof setInterval> | null = null\n    private _triggerSelectorListeners: Map<string, TriggerListenerData> = new Map()\n    private _surveyEventUnsubscribe: (() => void) | null = null\n\n    constructor(instance: PostHog) {\n        this._instance = instance\n    }\n\n    start(): void {\n        if (this._checkInterval) {\n            return\n        }\n\n        this._checkInterval = setInterval(() => {\n            this._evaluateAndDisplayTours()\n        }, CHECK_INTERVAL_MS)\n\n        this._evaluateAndDisplayTours()\n        addEventListener(document, 'visibilitychange', this._handleVisibilityChange)\n    }\n\n    stop(): void {\n        if (this._checkInterval) {\n            clearInterval(this._checkInterval)\n            this._checkInterval = null\n        }\n        document.removeEventListener('visibilitychange', this._handleVisibilityChange)\n        this._removeAllTriggerListeners()\n        this._cleanup()\n    }\n\n    private _handleVisibilityChange = (): void => {\n        if (document.hidden && this._checkInterval) {\n            clearInterval(this._checkInterval)\n            this._checkInterval = null\n        } else if (!document.hidden && !this._checkInterval) {\n            this._checkInterval = setInterval(() => {\n                this._evaluateAndDisplayTours()\n            }, CHECK_INTERVAL_MS)\n            this._evaluateAndDisplayTours()\n        }\n    }\n\n    private _evaluateAndDisplayTours(): void {\n        // Use getProductTours (not getActiveProductTours) because trigger_selector tours\n        // should work even if completed/dismissed\n        this._instance.productTours?.getProductTours((tours) => {\n            if (tours.length === 0) {\n                this._removeAllTriggerListeners()\n                return\n            }\n\n            const activeTriggerTourIds = new Set<string>()\n\n            for (const tour of tours) {\n                // Determine the trigger selector - explicit trigger_selector takes precedence,\n                // otherwise use conditions.selector for click-only tours (auto_launch=false)\n                const triggerSelector = tour.trigger_selector || (!tour.auto_launch ? tour.conditions?.selector : null)\n\n                // Tours with a trigger selector: always attach listener\n                // These are \"on-demand\" tours that show when clicked\n                if (triggerSelector) {\n                    activeTriggerTourIds.add(tour.id)\n                    this._manageTriggerSelectorListener({ ...tour, trigger_selector: triggerSelector })\n                }\n\n                // Only auto-show if auto_launch is enabled\n                if (tour.auto_launch && !this._activeTour && this._isTourEligible(tour)) {\n                    this.showTour(tour)\n                }\n            }\n\n            this._triggerSelectorListeners.forEach(({ tour }) => {\n                if (!activeTriggerTourIds.has(tour.id)) {\n                    this._removeTriggerSelectorListener(tour.id)\n                }\n            })\n        })\n    }\n\n    private _isTourEligible(tour: ProductTour): boolean {\n        if (!checkTourConditions(tour)) {\n            logger.info(`Tour ${tour.id} failed conditions check`)\n            return false\n        }\n\n        const completedKey = `ph_product_tour_completed_${tour.id}`\n        const dismissedKey = `ph_product_tour_dismissed_${tour.id}`\n\n        if (localStore._get(completedKey) || localStore._get(dismissedKey)) {\n            logger.info(`Tour ${tour.id} already completed or dismissed`)\n            return false\n        }\n\n        if (tour.internal_targeting_flag_key) {\n            const flagValue = this._instance.featureFlags?.getFeatureFlag(tour.internal_targeting_flag_key)\n            if (!flagValue) {\n                logger.info(`Tour ${tour.id} failed feature flag check: ${tour.internal_targeting_flag_key}`)\n                return false\n            }\n        }\n\n        return true\n    }\n\n    showTour(tour: ProductTour, reason: ProductTourRenderReason = 'auto'): void {\n        // Validate all step selectors before showing the tour\n        // Steps without selectors are modal steps and don't need validation\n        const selectorFailures: Array<{\n            stepIndex: number\n            stepId: string\n            selector: string\n            error: string\n            matchCount: number\n        }> = []\n\n        for (let i = 0; i < tour.steps.length; i++) {\n            const step = tour.steps[i]\n\n            // Skip validation for modal steps (no selector)\n            if (!step.selector) {\n                continue\n            }\n\n            const result = findElementBySelector(step.selector)\n\n            if (result.error === 'not_found' || result.error === 'not_visible') {\n                selectorFailures.push({\n                    stepIndex: i,\n                    stepId: step.id,\n                    selector: step.selector,\n                    error: result.error,\n                    matchCount: result.matchCount,\n                })\n            }\n        }\n\n        if (selectorFailures.length > 0) {\n            // Emit events for each failed selector for debugging/data purposes\n            for (const failure of selectorFailures) {\n                this._captureEvent('product tour step selector failed', {\n                    $product_tour_id: tour.id,\n                    $product_tour_step_id: failure.stepId,\n                    $product_tour_step_order: failure.stepIndex,\n                    $product_tour_step_selector: failure.selector,\n                    $product_tour_error: failure.error,\n                    $product_tour_matches_count: failure.matchCount,\n                    $product_tour_failure_phase: 'validation',\n                })\n            }\n\n            const failedSelectors = selectorFailures.map((f) => `Step ${f.stepIndex}: \"${f.selector}\" (${f.error})`)\n            logger.warn(\n                `Tour \"${tour.name}\" (${tour.id}) not shown: ${selectorFailures.length} selector(s) failed to match:\\n  - ${failedSelectors.join('\\n  - ')}`\n            )\n            return\n        }\n\n        this._activeTour = tour\n        this._currentStepIndex = 0\n        this._renderReason = reason\n\n        this._captureEvent('product tour shown', {\n            $product_tour_id: tour.id,\n            $product_tour_name: tour.name,\n            $product_tour_iteration: tour.current_iteration || 1,\n            $product_tour_render_reason: reason,\n        })\n\n        this._renderCurrentStep()\n    }\n\n    showTourById(tourId: string): void {\n        logger.info(`showTourById(${tourId})`)\n        this._instance.productTours?.getProductTours((tours) => {\n            const tour = tours.find((t) => t.id === tourId)\n            if (tour) {\n                logger.info(`found tour: `, tour)\n                this.showTour(tour, 'api')\n            } else {\n                logger.info('could not find tour', tourId)\n            }\n        })\n    }\n\n    nextStep = (): void => {\n        if (!this._activeTour) {\n            return\n        }\n\n        const currentStep = this._activeTour.steps[this._currentStepIndex]\n\n        this._captureEvent('product tour step completed', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: currentStep.id,\n            $product_tour_step_order: this._currentStepIndex,\n        })\n\n        if (this._currentStepIndex < this._activeTour.steps.length - 1) {\n            this._currentStepIndex++\n            this._renderCurrentStep()\n        } else {\n            this._completeTour()\n        }\n    }\n\n    previousStep = (): void => {\n        if (!this._activeTour || this._currentStepIndex === 0) {\n            return\n        }\n\n        this._currentStepIndex--\n        this._renderCurrentStep()\n    }\n\n    dismissTour = (reason: ProductTourDismissReason = 'user_clicked_skip'): void => {\n        if (!this._activeTour) {\n            return\n        }\n\n        const currentStep = this._activeTour.steps[this._currentStepIndex]\n\n        this._captureEvent('product tour dismissed', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: currentStep.id,\n            $product_tour_step_order: this._currentStepIndex,\n            $product_tour_dismiss_reason: reason,\n        })\n\n        localStore._set(`ph_product_tour_dismissed_${this._activeTour.id}`, true)\n\n        this._cleanup()\n    }\n\n    private _completeTour(): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        this._captureEvent('product tour completed', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_steps_count: this._activeTour.steps.length,\n        })\n\n        localStore._set(`ph_product_tour_completed_${this._activeTour.id}`, true)\n\n        this._instance.capture('$set', {\n            $set: {\n                [`$product_tour_completed/${this._activeTour.id}`]: true,\n            },\n        })\n\n        this._cleanup()\n    }\n\n    private _renderCurrentStep(): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        const step = this._activeTour.steps[this._currentStepIndex]\n\n        // Survey step - display the linked survey and listen for completion\n        if (step.linkedSurveyId) {\n            this._renderSurveyStep(step.linkedSurveyId)\n            return\n        }\n\n        // Modal step (no selector) - render without a target element\n        if (!step.selector) {\n            this._captureEvent('product tour step shown', {\n                $product_tour_id: this._activeTour.id,\n                $product_tour_step_id: step.id,\n                $product_tour_step_order: this._currentStepIndex,\n                $product_tour_step_type: 'modal',\n            })\n\n            this._renderTooltipWithPreact(null)\n            return\n        }\n\n        const result = findElementBySelector(step.selector)\n\n        if (result.error === 'not_found' || result.error === 'not_visible') {\n            this._captureEvent('product tour step selector failed', {\n                $product_tour_id: this._activeTour.id,\n                $product_tour_step_id: step.id,\n                $product_tour_step_order: this._currentStepIndex,\n                $product_tour_step_selector: step.selector,\n                $product_tour_error: result.error,\n                $product_tour_matches_count: result.matchCount,\n                $product_tour_failure_phase: 'runtime',\n            })\n\n            logger.warn(\n                `Tour \"${this._activeTour.name}\" dismissed: element for step ${this._currentStepIndex} became unavailable (${result.error})`\n            )\n            this.dismissTour('element_unavailable')\n            return\n        }\n\n        if (result.error === 'multiple_matches') {\n            this._captureEvent('product tour step selector failed', {\n                $product_tour_id: this._activeTour.id,\n                $product_tour_step_id: step.id,\n                $product_tour_step_order: this._currentStepIndex,\n                $product_tour_step_selector: step.selector,\n                $product_tour_error: result.error,\n                $product_tour_matches_count: result.matchCount,\n                $product_tour_failure_phase: 'runtime',\n            })\n            // Continue with first match for multiple_matches case\n        }\n\n        if (!result.element) {\n            return\n        }\n\n        const element = result.element\n        const metadata = getElementMetadata(element)\n\n        this._captureEvent('product tour step shown', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: step.id,\n            $product_tour_step_order: this._currentStepIndex,\n            $product_tour_step_selector: step.selector,\n            $product_tour_step_selector_found: true,\n            $product_tour_step_element_tag: metadata.tag,\n            $product_tour_step_element_id: metadata.id,\n            $product_tour_step_element_classes: metadata.classes,\n            $product_tour_step_element_text: metadata.text,\n        })\n\n        this._renderTooltipWithPreact(element)\n    }\n\n    private _renderTooltipWithPreact(element: HTMLElement | null): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        const step = this._activeTour.steps[this._currentStepIndex]\n        const { shadow } = retrieveTourShadow(this._activeTour.id)\n\n        render(\n            <ProductTourTooltip\n                tour={this._activeTour}\n                step={step}\n                stepIndex={this._currentStepIndex}\n                totalSteps={this._activeTour.steps.length}\n                targetElement={element}\n                onNext={this.nextStep}\n                onPrevious={this.previousStep}\n                onDismiss={this.dismissTour}\n            />,\n            shadow\n        )\n    }\n\n    private _renderSurveyStep(surveyId: string): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        const step = this._activeTour.steps[this._currentStepIndex]\n\n        // Emit tour step shown event\n        this._captureEvent('product tour step shown', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: step.id,\n            $product_tour_step_order: this._currentStepIndex,\n            $product_tour_step_type: 'survey',\n            $product_tour_linked_survey_id: surveyId,\n        })\n\n        // Clean up any existing survey event listener\n        this._cleanupSurveyListener()\n\n        // Set up listener for survey events\n        this._surveyEventUnsubscribe = this._instance.on(\n            'eventCaptured',\n            (data: { event: string; properties?: Record<string, any> }) => {\n                const eventSurveyId = data.properties?.[SurveyEventProperties.SURVEY_ID]\n                if (eventSurveyId !== surveyId) {\n                    return\n                }\n\n                if (data.event === SurveyEventName.SENT) {\n                    logger.info(`Survey ${surveyId} completed, advancing tour`)\n                    this._cleanupSurveyListener()\n                    this.nextStep()\n                } else if (data.event === SurveyEventName.DISMISSED) {\n                    logger.info(`Survey ${surveyId} dismissed, dismissing tour`)\n                    this._cleanupSurveyListener()\n                    this.dismissTour('user_clicked_skip')\n                }\n            }\n        )\n\n        // Display the survey\n        this._instance.surveys?.displaySurvey(surveyId, {\n            ignoreConditions: true,\n            ignoreDelay: true,\n            displayType: DisplaySurveyType.Popover,\n        })\n\n        logger.info(`Displayed survey ${surveyId} for tour step ${this._currentStepIndex}`)\n    }\n\n    private _cleanupSurveyListener(): void {\n        this._surveyEventUnsubscribe?.()\n        this._surveyEventUnsubscribe = null\n    }\n\n    private _cleanup(): void {\n        if (this._activeTour) {\n            removeTourFromDom(this._activeTour.id)\n        }\n\n        this._cleanupSurveyListener()\n        this._activeTour = null\n        this._currentStepIndex = 0\n        this._renderReason = 'auto'\n    }\n\n    private _manageTriggerSelectorListener(tour: ProductTour): void {\n        if (!tour.trigger_selector) {\n            return\n        }\n\n        const currentElement = document.querySelector(tour.trigger_selector)\n        const existingListenerData = this._triggerSelectorListeners.get(tour.id)\n\n        if (!currentElement) {\n            if (existingListenerData) {\n                this._removeTriggerSelectorListener(tour.id)\n            }\n            return\n        }\n\n        if (existingListenerData) {\n            if (currentElement !== existingListenerData.element) {\n                logger.info(`Trigger element changed for tour ${tour.id}. Re-attaching listener.`)\n                this._removeTriggerSelectorListener(tour.id)\n            } else {\n                return\n            }\n        }\n\n        if (!currentElement.hasAttribute(TRIGGER_LISTENER_ATTRIBUTE)) {\n            const listener = (event: Event) => {\n                event.stopPropagation()\n\n                if (this._activeTour) {\n                    logger.info(`Tour ${tour.id} trigger clicked but another tour is active`)\n                    return\n                }\n\n                logger.info(`Tour ${tour.id} triggered by click on ${tour.trigger_selector}`)\n                this.showTour(tour, 'trigger')\n            }\n\n            addEventListener(currentElement, 'click', listener)\n            currentElement.setAttribute(TRIGGER_LISTENER_ATTRIBUTE, tour.id)\n            this._triggerSelectorListeners.set(tour.id, { element: currentElement, listener, tour })\n            logger.info(`Attached trigger listener for tour ${tour.id} on ${tour.trigger_selector}`)\n        }\n    }\n\n    private _removeTriggerSelectorListener(tourId: string): void {\n        const existing = this._triggerSelectorListeners.get(tourId)\n        if (existing) {\n            existing.element.removeEventListener('click', existing.listener)\n            existing.element.removeAttribute(TRIGGER_LISTENER_ATTRIBUTE)\n            this._triggerSelectorListeners.delete(tourId)\n            logger.info(`Removed trigger listener for tour ${tourId}`)\n        }\n    }\n\n    private _removeAllTriggerListeners(): void {\n        this._triggerSelectorListeners.forEach((_, tourId) => {\n            this._removeTriggerSelectorListener(tourId)\n        })\n    }\n\n    private _captureEvent(eventName: string, properties: Record<string, any>): void {\n        this._instance.capture(eventName, properties)\n    }\n\n    // Public API methods delegated from PostHogProductTours\n    getActiveProductTours(callback: ProductTourCallback): void {\n        this._instance.productTours?.getProductTours((tours, context) => {\n            if (!context?.isLoaded) {\n                callback([], context)\n                return\n            }\n\n            const activeTours = tours.filter((tour) => this._isTourEligible(tour))\n            callback(activeTours, context)\n        })\n    }\n\n    resetTour(tourId: string): void {\n        localStore._remove(`ph_product_tour_completed_${tourId}`)\n        localStore._remove(`ph_product_tour_dismissed_${tourId}`)\n    }\n\n    resetAllTours(): void {\n        const storage = window?.localStorage\n        if (!storage) {\n            return\n        }\n        const keysToRemove: string[] = []\n        for (let i = 0; i < storage.length; i++) {\n            const key = storage.key(i)\n            if (key?.startsWith('ph_product_tour_completed_') || key?.startsWith('ph_product_tour_dismissed_')) {\n                keysToRemove.push(key)\n            }\n        }\n        keysToRemove.forEach((key) => localStore._remove(key))\n    }\n}\n"]}